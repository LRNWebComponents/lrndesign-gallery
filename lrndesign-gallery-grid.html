<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../juicy-html/juicy-html.html">
<link rel="import" href="../iron-image/iron-image.html">
<link rel="import" href="../iron-list/iron-list.html">
<link rel="import" href="lrndesign-gallery-zoom-button.html">

<!--
`lrndesign-gallery-grid`
A LRN element that renders a collection of gallery items into a carousel or a single media item into a layout.

@demo demo/index.html

@microcopy - the mental model for this element
  <lrndesign-gallery-grid 
    aspect = "1:1"                    //optional, can be 1:1, 5:4, 4:3 (default), 3:2, 16:9.
    items = "[]"                      //required, array of items
    sizing = "contain"                //optional, "cover" for cropping (default) or "contain" for letterboxing
    theme = "dark">                   //optional, dark or default
  </lrndesign-gallery-grid>

  To load data into carousel:
  <script>
    [{
      "alt": "IMAGE ALT TEXT",                          //required
      "details": "TEXT ABOUT IMAGE HERE",               //optional 
      "id": "123"                                       //required, unique id  
      "sizing": "contain",                              //optional, "cover" for cropping (default) or "contain" for letterboxing, default is parent's sizing
      "src": "PATH/TO/FULL/IMAGE/HERE.JPG",             //required
      "thumbnail": "PATH/TO/THUMBAIL/IMAGE/HERE.JPG",   //required
      "title": "IMAGE TITLE HERE",                      //optional
      "type": "image",                                  //required, "image", "video", "audio", etc.
      "zoom": false                                     //optional, false item should have no zoom option, default is true 
    }]

-->

<dom-module id="lrndesign-gallery-grid">
  <template>
    <style>
      :host {
        display: block;
        margin: 15px 0 0;
        padding: 0;
      }
      :host .sr-only {
        position: absolute;
        left: -999999;
        height: 0;
        width: 0;
        overflow: hidden;
      }
      lrndesign-gallery-grid-thumbnail {
        width: 100px;
        height: 100px;
      }
      
      @media print {
        :host #gallery {
          display: none;
        }
      }
    </style>
    <template is="dom-if">
      <p class="sr-only">A collection of thumbnails:</p>
    </template>
    <div id="gallery" tabindex="-1" aria-live="polite">
      <iron-list id="thumbslist" items="[[__items]]" as="item" grid selection-enabled>
        <template>
          <lrndesign-gallery-zoom-button 
            alt$="[[item.alt]]" 
            item-title$="[[item.title]]"
            size="medium"
            src$="[[item.src]]" height="150px" width="150px">
            <div slot="button-image">
              <div height="150px" width="150px">
              <iron-image 
                alt$="[[item.alt]]" 
                class="lrndesign-gallery-grid-thumbnail" 
                fade 
                height="150px"
                sizing="cover" 
                src$="[[item.thumbnail]]"
                width="150px">
              </iron-image>
              </div>
            </div>
            <div slot="details">
              <juicy-html html$="[[item.details]]"></juicy-html>
            </div>
          </lrndesign-gallery-zoom-button>
        </template>
      </iron-list>
    </div>
  </template>

  <script>
    Polymer({

      is: 'lrndesign-gallery-grid',
      
      listeners: {
        'navTap': '_onNavTapped',
      },

      properties: {
        /** 
        * aspect ratio of media: 1:1, 5:4, 4:3, 3:2, or 16:9
        */
        aspect: {
          type: String,
          value: '4:3'
        },
        /** 
         * array of carousel items
         */
        items: {
          type: Array,
          value: [],
          notify: true,
          observer: '_itemsLoaded'
        },
        /** 
         * the parent item
         */
        parent: {
          type: Object,
          value: {}
        },
        /*
         * data for the selected item
         */
        selected: {
          type: Object,
          value: {},
          notify: true,
          reflectToAttribute: true
        },
        /**
         * default sizing: fit screen by cropping (cover) 
         * or with letterboxing (contain)
         */
        sizing: {
          type: String,
          value: 'cover'
        },
        /** 
         * theme of the carousel: default or dark
         */
        theme: {
          type: String,
          value: 'default'
        },
        /** 
         * carousel's title
         */
        title: {
          type: String,
          value: null
        },
      },
      /**
       * gets unique id for carousel and sets it as a target
       */
      attached: function(){
        this.__gallery = this.$.gallery;
      },
      /**
       * gets unique id for carousel and sets it as a target
       */
      _itemsLoaded: function(){
        let temp = [];
        if(this.items !== undefined && this.items !== null && this.items.length > 0){
          for (i in this.items) {
            temp[i] = this.items[i];
            temp[i].sizing = temp[i].sizing !== undefined ? temp[i].sizing : this.sizing;
          }
          this.items = [];
          this.items.splice(0,0, ...temp);
          this.__items = temp;
          this.$.thumbslist.fire('iron-resize');
        }
      },
      /** 
      * returns true if the given attribute is not null
      */
      _isAttrSet: function (attr){
        return attr !== null && attr !== undefined;
      }
    });
  </script>
</dom-module>
