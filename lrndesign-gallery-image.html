<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-image/iron-image.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../juicy-html/juicy-html.html">
<link rel="import" href="../responsive-utility/responsive-utility.html">
<link rel="import" href="lrndesign-gallery-zoom-button.html">
<link rel="import" href="lrndesign-gallery-prevnext.html">
<link rel="import" href="lrndesign-gallery-print.html">

<!--
`lrndesign-gallery-image`
A LRN element that renders a single image with caption.

@demo demo/index.html

@microcopy - the mental model for this element
  <lrndesign-gallery-image 
    aspect = "1:1"                                  //optional, can be 1:1, 5:4, 4:3 (default), 3:2, 16:9.
    alt = "IMAGE ALT TEXT"                          //required
    details = TEXT ABOUT IMAGE HERE"                //optional
    sizing = "contain"                              //optional, "cover" for cropping (default) or "contain" for letterboxing
    src = "PATH/TO/FULL/IMAGE/HERE.JPG",            //required, path to full-sized image
    theme = "dark"                                  //optional, dark or default
    thumbnail = "PATH/TO/THUMBAIL/IMAGE/HERE.JPG"   //optional, preload a smaller image
    title = "My Image">                             //optional
  </lrndesign-gallery-image>

-->

<dom-module id="lrndesign-gallery-image">
  <template>
    <style>
      :host {
        display: block;
      }
      :host .sr-only {
        position: absolute;
        left: -999999;
        height: 0;
        width: 0;
        overflow: hidden;
      }
      :host .print {
        display: none;
        margin-bottom: 15px;
      }
      :host .print iron-image {
        display: block;
        margin-top: 15px;
        width: 100%;
        height: 400px;
      }
      @media screen {
        :host ::slotted(#items) {
          display: none;
        }
        :host .x-of-y {
          font-size: 85%;
          font-style: italic;
          text-align: right;
        }
        :host #items {
          margin-top: 15px;
          width: 100%;
          position: relative;
          background-color: #eee;
          border: 1px solid #eee;
        }
        :host[theme="dark"] #items {
          background-color: black;
          border: 1px solid black;
          color: white;
        }
        :host lrndesign-gallery-zoom-button {
          position: absolute;
          left: 0px;
          bottom: 0px;
          z-index: 2; 
        }
        :host #details {
          max-height: 100%;
          position: absolute;
          right: 0;
          top: 0;
          color: black;
          background-color: #f8f8f8;
        }
        :host[theme="dark"] #details {
          background-color: #222;
          color: white;
        }
        :host #details-inner {
          width: 100%;
          position: absolute;
          max-height: 45%;
          left: 0;
          top: 0;
          overflow-y: scroll;
        }
        :host #details-inner > * {
          padding: 0 20px;
        }
        :host[screen="xl"] #items {
          padding-top: 20%;
        }
        :host[screen="xl"] #details {
          padding-bottom: 20%;
        }
        :host[screen="xl"][aspect="16:9"] #details {
          width: 64.44%;
        }
        :host[screen="xl"][aspect="3:2"] #details {
          width: 70%;
        }
        :host[screen="xl"][aspect="4:3"] #details {
          width: 73.73%;
        }
        :host[screen="xl"][aspect="5:4"] #details{
          width: 68.75%;
        }
        :host[screen="xl"][aspect="1:1"] #details {
          width: 80%;
        }
        :host[screen="lg"] #items {
          padding-top: 25%;
        }
        :host[screen="lg"] #details {
          padding-bottom: 25%;
        }
        :host[screen="lg"][aspect="16:9"] #details {
          width: 52%;
        }
        :host[screen="lg"][aspect="3:2"] #details {
          width: 62.5%;
        }
        :host[screen="lg"][aspect="4:3"] #details {
          width: 66.67%;
        }
        :host[screen="lg"][aspect="5:4"] #details {
          width: 68.75%;
        }
        :host[screen="lg"][aspect="1:1"] #details {
          width: 75%;
        }
        :host[screen="md"] #items {
          padding-top: 33.33%;
        }
        :host[screen="md"] #details {
          padding-bottom: 33.33%;
        }
        :host[screen="md"][aspect="16:9"] #details {
          width: 40.75%;
        }
        :host[screen="md"][aspect="3:2"] #details {
          width: 50%;
        }
        :host[screen="md"][aspect="4:3"] #details {
          width: 66.67%;
        }
        :host[screen="md"][aspect="5:4"] #details {
          width: 58.34%;
        }
        :host[screen="md"][aspect="1:1"] #details {
          width: 66.67%;
        }
        :host[screen="sm"] #items {
          padding-top: 40%;
        }
        :host[screen="sm"] #details {
          padding-bottom: 40%;
        }
        :host[screen="sm"][aspect="16:9"] #details {
          width: 28.89%;
        }
        :host[screen="sm"][aspect="3:2"] #details {
          width: 40%;
        }
        :host[screen="sm"][aspect="4:3"] #details {
          width: 46.67%;
        }
        :host[screen="sm"][aspect="5:4"] #details {
          width: 50%;
        }
        :host[screen="sm"][aspect="1:1"] #details {
          width: 60%;
        }
        :host[screen="xs"] #details {
          width: 100%;
        }
        :host[screen="xs"] #details {
          padding-bottom: 40%;
        }
        :host[screen="xs"][aspect="16:9"] #items {
          padding-top: 96.25%;
        }
        :host[screen="xs"][aspect="16:9"] #details {
          top: 58.44%;
        }
        :host[screen="xs"][aspect="3:2"] #items {
          padding-top: 106.67%;
        }
        :host[screen="xs"][aspect="3:2"] #details {
          top: 62.05%;
        }
        :host[screen="xs"][aspect="4:3"] #items {
          padding-top: 115%;
        }
        :host[screen="xs"][aspect="4:3"] #details {
          top: 65.22%;
        }
        :host[screen="xs"][aspect="5:4"] #items {
          padding-top: 120%;
        }
        :host[screen="xs"][aspect="5:4"] #details {
          top: 66.67%;
        }
        :host[screen="xs"][aspect="1:1"] #items {
          padding-top: 140%;
        }
        :host[screen="xs"][aspect="1:1"] #details {
          top: 71.43%;
        }
      }
      @media print {
        :host #gallery-image {
          display: none;
        }
        :host .print {
          margin-top: 15px;
          display: block;
        }
        :host .print-image {
          max-width: 400px;
          max-height: 400px;
          display:block;
          border: 1px solid #ddd;
          page-break-inside: avoid;
        }
      }
    </style>
    Hello
    <responsive-utility responsive-to-parent="true"></responsive-utility>
    <article id="gallery-image">
      <div id="items">
        <iron-image 
          alt$="[[alt]]" 
          class="prevnext" 
          fade 
          placeholder$="[[thumbnail]]" 
          sizing$="[[sizing]]" 
          src$="[[src]]" >
        </iron-image>
        <div id="details">
          <div id="details-inner">
            <template is="dom-if" if="[[hasTitle]]">
              <h1 id="carousel-title">[[title]]</h1>
            </template>
            <div><juicy-html html$="[[details]]"></juicy-html></div>
          </div>
        </div>
        <template is="dom-if" if="[[zoom]]">
          <lrndesign-gallery-zoom-button 
            alt$="[[alt]]"
            heading$="[[heading]]"
            src$="[[src]]" 
            tooltip$="[[tooltip]]">
          </lrndesign-gallery-zoom-button>
        </template>
        </div>
      </div>
    </div>
    <lrndesign-gallery-print
      alt$="[[alt]]" 
      details$="[[details]]" 
      heading$="[[heading]]" 
      src$="[[src]]" 
      title$="[[title]]">
    </lrndesign-gallery-print>
  </article>

  <script>
    Polymer({

      is: 'lrndesign-gallery-image',

      properties: {
        /** 
         * image's alt text
         */
        alt: {
          type: String,
          value: 'default',
        },
        /** 
        * aspect ratio of media: 1:1, 5:4, 4:3, 3:2, or 16:9
        */
        aspect: {
          type: String,
          value: '4:3',
        },
        /** 
         * image's details
         */
        details: {
          type: String,
          value: null,
        },
        /** 
         * does it have a title
         */
        hasTitle: {
          type: Boolean,
          computed: '_isAttrSet(title)',
        },
        /** 
         * image's dialog heading text
         */
        heading: {
          type: String,
          computed: '_getHeadingText(title)',
        },
        /** 
         * preload source
         */
         preload: {
          type: String,
          computed: '_getPreloadSrc(thumbnail,src)',
        },
        /**
         * screen size: xs, sm, md, lg, or xl
         */
        screen: {
          type: String,
          value: 'xs',
          notify: true,
          reflectToAttribute: true,
        },
        /**
         * default sizing: fit screen by cropping (cover) 
         * or with letterboxing (contain)
         */
        sizing: {
          type: String,
          value: 'cover',
        },
        /** 
         * image source
         */
        src: {
          type: String,
          value: null,
        },
        /** 
         * theme of the carousel: default or dark
         */
        theme: {
          type: String,
          value: 'default',
        },
        /** 
         * thumbnail/preload source
         */
        thumbnail: {
          type: String,
          value: null,
        },
        /** 
         * image's title
         */
        title: {
          type: String,
          value: null,
        },
        /** 
         * zoom button's tooltip
         */
        tooltip: {
          type: String,
          value: null,
          computed: '_getTooltip:(title)',
        },
        /** 
         * allow image zoom
         */
        zoom: {
          type: Boolean,
          value: true,
        },
      },
      ready: function(){
        console.log('ready',this);
      },
      /**
       * sets size class based on parent container and breakpoints
       */ 
      _onScreenResize: function(e){
        this.screen = e.detail.screen;
      },
      /** 
      * returns text for zoom button
      */
      _getPreloadSrc: function (thumbnail,src){
        return this._isAttrSet(thumbnail) ? thumbnail : src;
      },
      /** 
      * returns text for zoom button
      */
      _getZoomText: function (title){
        return this._isAttrSet(title) ? 'Zoom In ('+title+')' : 'Zoom In';
      },
      /** 
      * returns heading for zoom dialog
      */
      _getTooltip: function (title){
        return this._isAttrSet(title) ? title : 'Image Zoom';
      },
      /** 
      * returns true if the given attribute is not null
      */
      _isAttrSet: function (attr){
        return attr !== null;
      }
    });
  </script>
</dom-module>
